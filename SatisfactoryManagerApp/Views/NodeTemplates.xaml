<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:nodify="https://miroiu.github.io/nodify"
                    xmlns:vm="clr-namespace:SatisfactoryManagerApp.ViewModels">

    <!-- ══════════════════════════════════════════════════════════════
         COLOR PALETTE
    ══════════════════════════════════════════════════════════════════ -->
    <SolidColorBrush x:Key="AccentBrush"    Color="#FF6A00"/>
    <SolidColorBrush x:Key="CardBg"         Color="#1E1E2E"/>
    <SolidColorBrush x:Key="CardBorder"     Color="#3A3A5C"/>
    <SolidColorBrush x:Key="GroupBg"        Color="#252540"/>
    <SolidColorBrush x:Key="GroupBorder"    Color="#7B61FF"/>
    <SolidColorBrush x:Key="GoodFlow"       Color="#4CAF50"/>
    <SolidColorBrush x:Key="WarnFlow"       Color="#FF9800"/>
    <SolidColorBrush x:Key="BadFlow"        Color="#F44336"/>
    <SolidColorBrush x:Key="TextMuted"      Color="#9E9E9E"/>
    <SolidColorBrush x:Key="TextBright"     Color="#E0E0E0"/>

    <!-- ══════════════════════════════════════════════════════════════
         NODE STYLE — shared card appearance (CornerRadius goes on
         the ItemContainer or is overridden per-node via ControlTemplate)
    ══════════════════════════════════════════════════════════════════ -->
    <Style x:Key="BaseNodeStyle" TargetType="{x:Type nodify:Node}">
        <Setter Property="Background"   Value="{StaticResource CardBg}"/>
        <Setter Property="BorderBrush"  Value="{StaticResource CardBorder}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding"      Value="6"/>
        <Setter Property="HeaderBrush"  Value="#2A2A3E"/>
    </Style>

    <Style x:Key="GroupNodeStyle" TargetType="{x:Type nodify:Node}" BasedOn="{StaticResource BaseNodeStyle}">
        <Setter Property="Background"      Value="{StaticResource GroupBg}"/>
        <Setter Property="BorderBrush"     Value="{StaticResource GroupBorder}"/>
        <Setter Property="BorderThickness" Value="2"/>
        <Setter Property="Padding"         Value="8"/>
        <Setter Property="HeaderBrush"     Value="#33326A"/>
    </Style>

    <Style x:Key="LogisticNodeStyle" TargetType="{x:Type nodify:Node}" BasedOn="{StaticResource BaseNodeStyle}">
        <Setter Property="Background"   Value="#1A2A1A"/>
        <Setter Property="BorderBrush"  Value="{StaticResource GoodFlow}"/>
        <Setter Property="HeaderBrush"  Value="#1E321E"/>
        <Setter Property="Padding"      Value="4"/>
    </Style>

    <!-- ══════════════════════════════════════════════════════════════
         PORT TEMPLATES — NodeInput (left side) / NodeOutput (right side)
    ══════════════════════════════════════════════════════════════════ -->
    <DataTemplate x:Key="InputPortTemplate" DataType="{x:Type vm:PortViewModel}">
        <nodify:NodeInput>
            <nodify:NodeInput.Header>
                <StackPanel Orientation="Horizontal" Margin="2,0">
                    <Ellipse Width="8" Height="8" Fill="{StaticResource AccentBrush}" Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextMuted}" FontSize="10"/>
                </StackPanel>
            </nodify:NodeInput.Header>
        </nodify:NodeInput>
    </DataTemplate>

    <DataTemplate x:Key="OutputPortTemplate" DataType="{x:Type vm:PortViewModel}">
        <nodify:NodeOutput>
            <nodify:NodeOutput.Header>
                <StackPanel Orientation="Horizontal" Margin="2,0">
                    <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextMuted}" FontSize="10" Margin="0,0,4,0"/>
                    <Ellipse Width="8" Height="8" Fill="{StaticResource AccentBrush}"/>
                </StackPanel>
            </nodify:NodeOutput.Header>
        </nodify:NodeOutput>
    </DataTemplate>

    <!-- ══════════════════════════════════════════════════════════════
         MACHINE NODE TEMPLATE
    ══════════════════════════════════════════════════════════════════ -->
    <DataTemplate x:Key="MachineNodeTemplate" DataType="{x:Type vm:NodeViewModel}">
        <nodify:Node Header="{Binding Name}"
                     Input="{Binding Inputs}"
                     Output="{Binding Outputs}"
                     Style="{StaticResource BaseNodeStyle}"
                     InputConnectorTemplate="{StaticResource InputPortTemplate}"
                     OutputConnectorTemplate="{StaticResource OutputPortTemplate}">

            <!-- Efficiency badge in the node body -->
            <Border Background="#2A2A45" CornerRadius="4" Padding="6,3" Margin="0,4,0,0">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⚡ " Foreground="{StaticResource WarnFlow}" FontSize="11"/>
                    <TextBlock Text="Eficiencia: " Foreground="{StaticResource TextMuted}" FontSize="11"/>
                    <TextBlock Text="{Binding EfficiencyPercent}" FontSize="11" FontWeight="Bold">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{StaticResource GoodFlow}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsStarved}" Value="True">
                                        <Setter Property="Foreground" Value="{StaticResource BadFlow}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </Border>
        </nodify:Node>
    </DataTemplate>

    <!-- ══════════════════════════════════════════════════════════════
         FACTORY GROUP NODE TEMPLATE
    ══════════════════════════════════════════════════════════════════ -->
    <DataTemplate x:Key="GroupNodeTemplate" DataType="{x:Type vm:NodeViewModel}">
        <nodify:Node Header="{Binding Name}"
                     Input="{Binding Inputs}"
                     Output="{Binding Outputs}"
                     Style="{StaticResource GroupNodeStyle}"
                     InputConnectorTemplate="{StaticResource InputPortTemplate}"
                     OutputConnectorTemplate="{StaticResource OutputPortTemplate}">

            <StackPanel Margin="0,6,0,0">
                <!-- Power row -->
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⚡ " Foreground="{StaticResource WarnFlow}" FontSize="11"/>
                    <TextBlock Foreground="{StaticResource TextMuted}" FontSize="11">
                        <Run Text="{Binding TotalPowerMW, StringFormat={}{0:F1}}"/>
                        <Run Text=" MW"/>
                    </TextBlock>
                </StackPanel>

                <!-- "Enter group" button — routes command back to the EditorViewModel -->
                <Button Content="▶ Entrar al grupo"
                        Margin="0,6,0,0" FontSize="11" Padding="6,3"
                        Cursor="Hand"
                        Background="#7B61FF" Foreground="White" BorderThickness="0"
                        Command="{Binding DataContext.EnterGroupCommand,
                            RelativeSource={RelativeSource AncestorType=Window}}"
                        CommandParameter="{Binding}"/>
            </StackPanel>
        </nodify:Node>
    </DataTemplate>

    <!-- ══════════════════════════════════════════════════════════════
         SPLITTER / MERGER COMPACT TEMPLATE
    ══════════════════════════════════════════════════════════════════ -->
    <DataTemplate x:Key="LogisticNodeTemplate" DataType="{x:Type vm:NodeViewModel}">
        <nodify:Node Header="{Binding Name}"
                     Input="{Binding Inputs}"
                     Output="{Binding Outputs}"
                     Style="{StaticResource LogisticNodeStyle}"
                     InputConnectorTemplate="{StaticResource InputPortTemplate}"
                     OutputConnectorTemplate="{StaticResource OutputPortTemplate}"/>
    </DataTemplate>

    <!-- ══════════════════════════════════════════════════════════════
         NODE TYPE SELECTOR (default DataTemplate for NodeViewModel)
         Picks the right template based on NodeType string.
    ══════════════════════════════════════════════════════════════════ -->
    <DataTemplate DataType="{x:Type vm:NodeViewModel}">
        <ContentPresenter Content="{Binding}">
            <ContentPresenter.Style>
                <Style TargetType="ContentPresenter">
                    <Setter Property="ContentTemplate" Value="{StaticResource MachineNodeTemplate}"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding NodeType}" Value="Group">
                            <Setter Property="ContentTemplate" Value="{StaticResource GroupNodeTemplate}"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding NodeType}" Value="Splitter">
                            <Setter Property="ContentTemplate" Value="{StaticResource LogisticNodeTemplate}"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding NodeType}" Value="Merger">
                            <Setter Property="ContentTemplate" Value="{StaticResource LogisticNodeTemplate}"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ContentPresenter.Style>
        </ContentPresenter>
    </DataTemplate>

</ResourceDictionary>
